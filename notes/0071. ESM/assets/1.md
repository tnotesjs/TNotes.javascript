# ESM (ES Module)

## 核心概念

- 官方标准（ES6/ES2015）
- 静态结构（编译时确定依赖）
- 异步加载（支持浏览器和 Node.js）
- 实时绑定（Live Binding）

## 基本语法

### 导出方式

- 命名导出 `export`
  - 直接导出 `export const/function/class`
  - 统一导出 `export { ... }`
  - 重命名导出 `export { x as y }`
- 默认导出 `export default`
  - 每个模块只能有一个
  - 可导出任意值
- 聚合导出 `export ... from`
  - 转发其他模块的导出
  - 适合创建入口文件

### 导入方式

- 命名导入 `import { ... } from`
  - 必须使用导出的名称
  - 可导入多个
  - 可重命名 `import { x as y }`
- 默认导入 `import x from`
  - 可自定义名称
  - 导入默认导出
- 混合导入 `import x, { y } from`
  - 同时导入默认和命名导出
- 整体导入 `import * as x from`
  - 导入所有导出为对象
- 动态导入 `import()`
  - 返回 Promise
  - 支持按需加载
  - 支持条件加载

## 核心特性

### 静态分析

- 编译时确定模块依赖
- 支持 Tree Shaking
- 循环依赖友好

### 实时绑定

- 导入的是引用而非值
- 模块内部修改会反映到外部
- 导入的绑定是只读的

### 严格模式

- 自动启用严格模式
- 顶层 this 为 undefined
- 变量必须声明

## 环境支持

### 浏览器

- `<script type="module">`
- 自动 defer
- 支持 CORS
- 相对路径必须完整（含扩展名）

### Node.js

- 文件扩展名 `.mjs`
- `package.json` 设置 `"type": "module"`
- 支持 `import` 和 `export`

## vs CommonJS

### 加载时机

- ESM：异步加载
- CJS：同步加载

### 导出值

- ESM：实时绑定
- CJS：值的拷贝

### 环境

- ESM：浏览器 + Node.js
- CJS：主要是 Node.js

### this

- ESM：undefined
- CJS：exports

### 依赖分析

- ESM：静态（编译时）
- CJS：动态（运行时）
